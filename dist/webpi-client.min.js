/*! 在线树莓派 - v0.0.1 - 2015-02-13
* http://webpi.cokapp.com
* Copyright (c) 2015 cokapp; Licensed MIT */
window.console||(window.console={},window.console.log=function(){},window.console.warn=function(){},window.console.error=function(){});var piServices=angular.module("piServices",["cokjs.angular","ui.bootstrap"]),piApp=angular.module("piApp",["ngAnimate","ngCookies","ngSanitize","ngTouch","ui.router","cokjs.angular","piServices"]);piApp.config(["$provide","$urlRouterProvider","$stateProvider","$locationProvider",function(a,b,c,d){var e=(window.location.host,"http://cubie.heichengliang.me:2015/");a.value("socketURI",e),b.when("","/"),d.html5Mode({enabled:!0}).hashPrefix("#"),c.state("/",{url:"/",templateUrl:"tpls/pages/index.tpl.html",controller:"indexCtrl"}).state("app",{url:"/app",templateUrl:"tpls/pages/app.tpl.html",controller:"appCtrl"}).state("switcher",{url:"/switcher",templateUrl:"tpls/pages/switcher.tpl.html",controller:"switcherCtrl"}).state("otherwise",{url:"*path",templateUrl:"tpls/pages/e404.tpl.html",controller:"e404Ctrl"})}]),function(a){"use strict";a.module("piServices").factory("rootSvr",["$rootScope","socketSvr","$filter",function(a,b,c){a._pinDataMap=a._pinDataMap||{},a._pinDatas=a._pinDatas||[],a.$on("socket-get:init",function(a,b){for(var c in b){var e=b[c];d(e)}}),a.$on("socket-get:gpio",function(a,b){d(b)});var d=function(d){d.pin=parseInt(d.pin),a.$apply(function(){a._pinDataMap[d.pin]=d,a._pinDatas=c("obj2Array")(a._pinDataMap)}),b.fireEvent("pinchanged",d)},e={};return e.getPin=function(b){var c=parseInt(b);return a._pinDataMap[c]},e}])}(angular),function(a){"use strict";var b=null,c=null,d=function(a,c){b.$broadcast(a,c),0==a.indexOf("socket-get:")?(console.log("get data event: "+a),console.log(c)):0==a.indexOf("socket-set:")?(console.warn("set data event: "+a),console.warn(c)):(console.log("other event: "+a),console.log(c))};a.module("piServices").factory("socketSvr",["$rootScope","socketURI",function(a,e){b=a,c=io.connect(e),c.on("welcome",function(a){console.log(a)}),c.on("init",function(a){d("socket-get:init",a)}),c.on("gpio",function(a){d("socket-get:gpio",a)});var f={};return f.writePin=function(a,b){b.pin=a,c.emit("gpio",b),d("socket-set:gpio",b)},f.writePins=function(a){c.emit("gpios",a),d("socket-set:gpios",a)},f.fireEvent=d,f}])}(angular),function(a){"use strict";a.module("piApp").filter("obj2Array",function(){return function(a){var b=[];for(var c in a)b.push(a[c]);return b}})}(angular),angular.module("piApp").directive("piPin",["$rootScope","rootSvr","socketSvr",function(a,b,c){var d=function(a){var b={};for(var c in a)b[c]=a[c];return b};return{scope:{},restrict:"AE",replace:!0,templateUrl:"tpls/widgets/pin.tpl.html",link:function(b,e,f){var g=parseInt(f.piPin);a.$on("pinchanged",function(a,c){c.pin===g&&b.$apply(function(){b.gpio=c,b.gpio.modeName="INPUT"===b.gpio.mode?"IN":"OUT"})}),e.find(".pin").on("click",function(){var a=d(b.gpio);a.value=1==a.value?0:1,c.writePin(g,a)}),e.find(".mode").on("click",function(){var a=d(b.gpio);a.mode="INPUT"==a.mode?"out":"in",c.writePin(g,a)})}}}]),angular.module("piApp").directive("piSwitcher",["$rootScope","rootSvr","socketSvr",function(a,b,c){var d=function(a){var b={};for(var c in a)b[c]=a[c];return b};return{scope:{},restrict:"AE",replace:!0,templateUrl:"tpls/switcher/default.tpl.html",link:function(b,e,f){var g=parseInt(f.piSwitcher);a.$on("pinchanged",function(a,c){c.pin===g&&b.$apply(function(){b.gpio=c,b.gpio.modeName="INPUT"===b.gpio.mode?"IN":"OUT"})}),e.find(".pin").on("click",function(){var a=d(b.gpio);a.value=1==a.value?0:1,c.writePin(g,a)}),e.find(".mode").on("click",function(){var a=d(b.gpio);a.mode="INPUT"==a.mode?"out":"in",c.writePin(g,a)})}}}]),function(a){"use strict";a.module("piApp").controller("indexCtrl",["$scope","rootSvr",function(a){a.pinSort=function(a){return parseInt(a.pin)},a.pinOdd=function(a){return a.pin%2===1},a.pinEven=function(a){return a.pin%2===0}}])}(angular),function(a){"use strict";a.module("piApp").controller("switcherCtrl",["$scope","rootSvr",function(){}])}(angular);